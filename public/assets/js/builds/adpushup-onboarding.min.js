$("document").ready(function(){!function(a,b,c){var d=a.newSite;a.onboarding={showIntro:function(){var a=!1,c="static";b.currentUser.sites[b.currentUser.sites.length-1].step&&!d.showIntro||(d.addOtherSite?$("#addOtherSiteModal").modal({show:!0,backdrop:c,keyboard:a}):$("#intromodal").modal({show:!0,backdrop:c,keyboard:a}))},analyticsEventEmitter:function(a,b){var c=intercomObj||null;b?adpushupAnalyticsEvents.emit("analyticsTrack",{eventName:a,obj:{name:window.currentUser.firstName,email:window.currentUser.email},intercom:c}):adpushupAnalyticsEvents.emit("analyticsTrack",{eventName:"onboarding",obj:{action:"click",step:a},intercom:c})},templates:{checkIcon:'<i class="fa fa-check"></i>',otherPlatformVerification:'<div class="snippet-wrapper"> <span class="clipboard-copy"> Copied ! </span> <textarea class="snippet" id="header-code" readonly placeholder="AdPushup init code comes here.."></textarea> <div class="snippet-btn-wrapper"> <div><button data-toggle="modal" data-target="#sendToDevModal" id="sendToDev" class="snippet-btn apbtn-main-line apbtn-small"> Email Code <i class="fa fa-envelope-o"></i> </button> <button id="clipboardCopy" class="snippet-btn apbtn-main-line apbtn-small"> Copy to clipboard <i class="fa fa-clipboard"></i> </button> </div></div></div><div class="error-message detectap-error"> <span> Please make sure that the header code is present on the the specified URL </span><div id="detectapError"></div></div><div class="row"><button id="apCheck" class="apbtn-main btn-vr btn-wpdt ap-code-verify"> Verify </button> </div>',addOtherSite:'<form id="addSiteAltForm"> <div class="row add-site-alt-form"> <div class="col-sm-8 col-sm-offset-2"> <input name="site" class="input-box" type="url" placeholder="Enter Website URL" required> </div><div class="col-sm-6 col-sm-offset-3"> <button type="submit" class="apbtn-main mT-10"> Add Site </button> </div></div></form>',dashboardLink:'<div class="text-center" style="margin-top: 15px;"><a style="font-size: 1.2em;" class="link-primary" href="/user/dashboard">Go to dashboard</a></div>',addOtherSiteFinish:'<div class="text-center"><h2>Thank you for the information. Our team will contact you soon.</h2></div>'},manipulateElem:function(a,b,c,d){switch(c){case"htmlFadeIn":$(a).hide().html(b).fadeIn(d)}},anotherSiteModalOpen:function(){var a=$("#addOtherSiteModal"),b=$("#add-other-site-modal-content");b.html(this.templates.addOtherSiteFinish),a.modal({show:!0,backdrop:"static",keyboard:!1}),setTimeout(function(){window.location.replace("http://"+window.location.host+"/user/dashboard")},4e3)},setupCompleteAlert:function(){var a=this;if(d.addOtherSite)a.anotherSiteModalOpen();else{var b="http://"+window.location.host+"/thankyou";window.location.replace(b)}},scrollTo:function(a,b,c){$("html, body").animate({scrollTop:$("#step"+a).offset().top-b},c)},generateInitCode:function(a){var b="(function(w, d) { var s = d.createElement('script'); s.src = '//cdn.adpushup.com/"+a+"/adpushup.js'; s.type = 'text/javascript'; s.async = true; (d.getElementsByTagName('head')[0] || d.getElementsByTagName('body')[0]).appendChild(s); })(window, document);";$("#header-code").text('<script data-cfasync="false" type="text/javascript">'+b+"</script>")},rTrim:function(a,b){return a?a.replace(new RegExp(b+"*$"),""):""},domanize:function(a){return a?this.rTrim(a.replace("http://","").replace("https://","").replace("www.",""),"/"):""},extractWebsiteName:function(a){var b=/[^.]+/,c=this.domanize(a),d=c.match(b)[0];return d},apVerificationStep:function(){$("#platformVerificationContent").html(this.templates.otherPlatformVerification),this.generateInitCode(d.addedSite.siteId)},showStep:function(a){a=parseInt(a),$("#step"+a).addClass("active-step"),a>=3&&this.apVerificationStep();for(var b=1;b<a;b++)$("#step"+parseInt(b)+"-check").addClass("fa-check-circle zoomIn");switch(d.addedSite&&a>=2&&this.manipulateElem("#addSiteStr",'<h2 class="text-appear"><span>'+this.domanize(d.addedSite.domain)+"</span> has been Added!</h2>","htmlFadeIn",600),d.addedSite&&a>=4&&this.manipulateElem("#non-admin-email","*Email* - "+this.extractWebsiteName(d.addedSite.domain)+"@adpushup.com","htmlFadeIn",600),a>3&&$("#apCheck").html("Verified "+this.templates.checkIcon),a>4&&$("#adsenseoauth").html("Google Adsense Connected "+this.templates.checkIcon),this.scrollTo(a,0,1e3),a){case 1:$("#platformVerificationContent").html('<p class="text-center mT-10"><img class="platform-graphic" src="/assets/images/platform.png" width="150" height="150"/></p>')}},nextStep:function(a,b,c){var d=this;$("#step"+b+"-check").addClass("fa-check-circle zoomIn"),setTimeout(function(){$("#step"+a).addClass("active-step"),$("#step"+b).removeClass("active-step"),d.scrollTo(a,120,600)},c)},saveSiteModel:function(b,c,e,f){var g=this;$.post("/data/saveSite",{site:c,siteId:e,step:2},function(c){return c.success?(d.addedSite={domain:c.url,siteId:c.siteId},$(".add-site-alt-form").hide(),$("#addSiteStr").fadeIn(),g.manipulateElem("#addSiteStr",'<h2 class="text-appear"><span>'+b+"</span> has been Added!</h2>","htmlFadeIn",600),g.nextStep(3,2,1e3),g.apVerificationStep(),g.manipulateElem("#non-admin-email","*Email* - "+g.extractWebsiteName(d.addedSite.domain)+"@adpushup.com","htmlFadeIn",600),!0):(a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown"),$(f).html("Add "+b+" ?").prop("disabled",!1),!1)})},addSite:function(c,e,f,g){var h=this,i=!0;if(g||$(f).html("Adding "+c+" ...").prop("disabled",!0),d.addOtherSite||g){var j=function(){for(var a in b.currentUser.sites)if(b.currentUser.sites[a].domain===c+"/")return!0;return!1};j()?(a.apAlert(h.domanize(e)+" has already been added! Please add a different site.","#apdetect","inverted","slideDown"),i=!1):$.ajax({url:"/user/addSite",type:"POST",data:{site:e},async:!1,success:function(b){if(b.success){if(!d.addOtherSite){var g=66;h.updateCrmDealStatus(g),h.analyticsEventEmitter("Added Site")}$(f).fadeOut(100),h.saveSiteModel(c,e,b.siteId,f),i=!0}else a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown"),$(f).html("Lets Add "+c+" ?").prop("disabled",!1),i=!1}})}else this.saveSiteModel(c,e,d.viewObjects.unSavedSiteId,f);return i},detectApSuccess:function(b,c){a.apAlert("AdPushup has been successfully detected on the website!","#apdetect","success","slideDown"),d.addOtherSite?($(c).html("Setup Complete "+b.templates.checkIcon).after(b.templates.dashboardLink),b.nextStep(6,3,1e3)):($(c).html("Verified "+b.templates.checkIcon),b.nextStep(4,3,1e3))},detectAp:function(b,c){var e=this;$.get("/proxy/detectap",{url:b},function(b){b.ap?$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:d.addOtherSite?5:3},function(a){if(a.success){if(!d.addOtherSite){var b=67;e.updateCrmDealStatus(b),e.analyticsEventEmitter("Added AP Code")}e.detectApSuccess(e,c)}else alert("Some error occurred!")}):(a.apAlert("AdPushup was not detected on the website! Please make sure that the header code is present on the the specified URL","#apdetect","inverted","slideDown"),$(c).html("Verify").prop("disabled",!1))})},openOauthWindow:function(){var a=screen.width/2-350,b=screen.height/2-225;window.open("/user/requestOauth","Oauth Request","height=485,width=700,left="+a+",top="+b)},copyInitCode:function(){$(".clipboard-copy").fadeIn(),setTimeout(function(){$(".clipboard-copy").fadeOut()},1500),$("#header-code").select(),c.execCommand("copy")},sendCodeToDev:function(a){$("#sendCodeSubmit").prop("disabled",!0).html("Sending..."),$.post("/user/sendCode",a,function(a){a.success?($("#sendCodeSubmit").css("opacity",1).html("Code sent successfully!"),setTimeout(function(){$("#sendToDevModal").modal("toggle"),$("#sendCodeSubmit").prop("disabled",!1).html("Send")},2e3)):alert("Some error occurred!")})},nonAdminAccess:function(a){var b=this;a.html("Saving...").prop("disabled",!0),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:5},function(a){if(a.success){if(!d.addOtherSite){var c=69;b.updateCrmDealStatus(c),b.analyticsEventEmitter("Non-Admin Access")}b.nextStep(6,5,1e3)}else alert("Some error occurred!")})},showAddOtherSite:function(){d.addOtherSite&&$("#addSiteStr").html(this.templates.addOtherSite)},oauthHook:function(b){var c=this;try{JSON.parse(b.data)}catch(e){return!1}var f=JSON.parse(b.data);f.data?($("#adsenseoauth").html("Google Adsense Connected "+a.onboarding.templates.checkIcon).prop("disabled",!0),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:4},function(a){if(a.success){if(!d.addOtherSite){var b=68;c.updateCrmDealStatus(b),c.analyticsEventEmitter("Added OAuth")}c.nextStep(5,4,1e3)}else alert("Some error occurred!")})):a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown")},skipOauth:function(){var a=this;setTimeout(function(){$("#adsenseoauth").prop("disabled",!0)},1e3),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:5},function(b){b.success?($("#step4").removeClass("active-step"),a.nextStep(6,5,1e3)):alert("Some error occurred!")})},init:function(){this.showIntro(),this.showStep(d.defaultStep)},updateCrmDealStatus:function(a){$.post("/data/updateCrmDealStatus",{status:a})},serviceSelection:function(a,b){var c="http://"+window.location.host+"/thankyou",e=a.join(" | "),f=this;$.post("/user/setSiteServices",{servicesString:e,newSiteUnSavedDomain:d.viewObjects.origUnSavedDomain,newSiteSiteId:d.viewObjects.unSavedSiteId,newSiteDomanizedUrl:d.viewObjects.domanizedUrl},function(e){if(!e.success)return void b.text("Some error has occurred");if(a.length>1)window.location.replace(c);else if(1==a.length)if("only-adsense"==a[0]){if(!d.addOtherSite){var g=65;f.updateCrmDealStatus(g),f.analyticsEventEmitter("Selected Solution")}$("#intromodal").modal("hide"),f.nextStep(2,1,1e3)}else window.location.replace(c)})},addAnotherSite:function(b,c){var d=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;if(!b||!d.test(b))return a.apAlert("Please add a valid website","#apdetect","inverted","slideDown"),!1;var e=this.addSite(b,this.domanize(b),c,!0);e&&($(c).fadeOut(300),this.nextStep(3,2,1e3))},base64_encode:function(a){try{if(window.btoa)return window.btoa(a);var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}catch(p){return alert("Unable to transform, Please contact our support team."),!1}},getAdcode:function(a){var b=this.base64_encode(a);if(!b)return!1;var c=['<ins class="adPushupAds" data-ver="2" data-siteId="'+d.addedSite.siteId+'" data-ac="'+b+'"></ins><script data-cfasync="false" type="text/javascript">(function (w, d) { for (var i = 0, j = d.getElementsByTagName("ins"), k = j[i]; i < j.length; k = j[++i]){ if(k.className == "adPushupAds" && k.getAttribute("data-push") != "1") { ((w.adpushup = w.adpushup || {}).control = (w.adpushup.control || [])).push(k); k.setAttribute("data-push", "1"); (((w.adpushup = w.adpushup || {}).timeline = (w.adpushup.timeline || {})).tl_cntPsh = (w.adpushup.timeline.tl_cntPsh || [])).push(+new Date); } } var s = document.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = "//static.adpushup.com/js/adpushupadsv2.js"; (d.getElementsByTagName("head")[0]||d.getElementsByTagName("body")[0]).appendChild(s); })(window, document);</script>'];return c.join("\n")},codeCoversionProceed:function(){var b=this,c=!0;d.addOtherSite&&(c=!1),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:6,completeOnboarding:c},function(c){if(c.success){if(!d.addOtherSite){var e=70;b.updateCrmDealStatus(e),b.analyticsEventEmitter("Code Conversion"),b.analyticsEventEmitter("App-signup-second-stage",1)}b.setupCompleteAlert()}else a.apAlert("Some error has occurred!","#apdetect","inverted","slideDown")})},addOtherSiteFromDashboard:function(a,b,c){var d=this,e=$("#addOtherSiteModal .error-message-box");if(a.length>1)d.anotherSiteModalOpen();else if(1==a.length)if("only-adsense"==a[0]){var f=d.addSite(c,b,null,!0);f?($("#addOtherSiteModal").modal("hide"),$("#apdetect").fadeOut(),d.nextStep(3,2,1e3)):e.html("Site already added. Please enter another site")}else d.anotherSiteModalOpen()}},a.onboarding.init(),$("#onboarding-services-form").submit(function(b){b.preventDefault();var c=[],d=$(".error-message-box");return $(".checkbox-custom:checked").each(function(){c.push($(this).attr("name"))}),c.length<1?void d.text("Please select atleast one Service"):(d.text(""),void a.onboarding.serviceSelection(c,d))}),$("#onboarding-inner-services-form").submit(function(b){b.preventDefault();var c=[],d=$(".error-message-box"),e=$("#add-other-site").val();if($(".checkbox-custom:checked").each(function(){c.push($(this).attr("name"))}),c.length<1)return void d.text("Please select atleast one Service");d.text("");var f=e.replace(/\/$/,""),g=f.replace(/.*?:\/\//g,"");a.onboarding.addOtherSiteFromDashboard(c,g,f)}),window.addEventListener("message",a.onboarding.oauthHook,!1),$(".add-user-site").click(function(b){var c=d.viewObjects.domanizedUrl,e=(d.viewObjects.unSavedSiteId,d.viewObjects.origUnSavedDomain);a.onboarding.addSite(c,e,$(this),!0),$("#another-site-box").fadeOut("200")}),$("#add-another-site").click(function(a){a.preventDefault(),$("#addSiteStr").fadeOut(100),$("#another-site-box").fadeIn(500)}),$("#add-another-site-submit").click(function(b){b.preventDefault();var c=$("#another-site-input").val(),d=$("#another-site-box");a.onboarding.addAnotherSite(c,d)}),$(c).on("click","#apCheck",function(){$(this).html("Verifying...").prop("disabled",!0),a.onboarding.detectAp(d.addedSite.domain,$(this))}),$("#adsenseoauth").click(function(){a.onboarding.openOauthWindow()}),$(".adsensenonadmin").click(function(){a.onboarding.nonAdminAccess($(this))}),$(c).on("click","#clipboardCopy, #header-code",function(){a.onboarding.copyInitCode()}),$("#sendCodeForm").submit(function(b){b.preventDefault(),$("#headerCodeInput").val($("#header-code").val());var c=$(this).serialize();a.onboarding.sendCodeToDev(c)}),$("#skipOauth").on("click",function(){a.onboarding.skipOauth()}),$("#addSiteAltForm").submit(function(b){b.preventDefault();var c=$(this).serializeArray(),d=c[0].value.replace(/\/$/,"");site=d.replace(/.*?:\/\//g,""),btn=$("#addSiteAltForm button"),a.onboarding.addSite(site,d,btn)}),$("#code-conversion-button").click(function(b){var c,d=$("#code-conversion-box"),e=d.val();return e&&""!=e?(c=a.onboarding.getAdcode(e),void(c?d.val(c):a.apAlert("Some error has occurred!","#apdetect","inverted","slideDown"))):void a.apAlert("Please enter control ad code!","#apdetect","inverted","slideDown")}),$("#code-conversion-finish").click(function(b){b.preventDefault(),a.onboarding.codeCoversionProceed()})}(adpushup,window,document)});