$("document").ready(function(){!function(a,b,c){var d=a.newSite;a.onboarding={showIntro:function(){var a=b.localStorage.getItem("showIntro");!a&&d.showIntro&&($("#intromodal").modal("show"),b.localStorage.setItem("showIntro",!0))},templates:{checkIcon:'<i class="fa fa-check"></i>',otherPlatformVerification:' <p class="text-medium text-center" style="margin-top: -10px;">Copy and paste this snippet in the &lt;HEAD&gt; section of your website </p><div class="snippet-wrapper"> <span class="clipboard-copy"> Copied ! </span> <textarea class="snippet" id="header-code" readonly placeholder="AdPushup init code comes here.."></textarea> <div class="snippet-btn-wrapper"> <div><button data-toggle="modal" data-target="#sendToDevModal" id="sendToDev" class="snippet-btn apbtn-main-line apbtn-small"> Send Code to Developer <i class="fa fa-code"></i> </button> <button id="clipboardCopy" class="snippet-btn apbtn-main-line apbtn-small"> Copy to clipboard <i class="fa fa-clipboard"></i> </button> </div></div></div><div class="error-message detectap-error"> <p> Please make sure that the header code is present on the the specified URL </p><div id="detectapError"></div></div><div class="row"> <div class="col-sm-4 col-sm-offset-4"> <button id="apCheck" class="apbtn-main btn-vr btn-wpdt"> Verify </button> </div></div>',addOtherSite:'<form id="addSiteAltForm"> <div class="row add-site-alt-form"> <div class="col-sm-8 col-sm-offset-2"> <input name="site" class="input-box" type="url" placeholder="Enter Website URL" required> </div><div class="col-sm-6 col-sm-offset-3"> <button type="submit" class="apbtn-main mT-10"> Add Site </button> </div></div></form>',dashboardLink:'<div class="text-center" style="margin-top: 15px;"><a style="font-size: 1.2em;" class="link-primary" href="/user/dashboard">Go to dashboard</a></div>'},manipulateElem:function(a,b,c,d){switch(c){case"htmlFadeIn":$(a).hide().html(b).fadeIn(d)}},setupCompleteAlert:function(){var a=this;setTimeout(function(){$("#skipOauth").hide(),$("#dsBLink").html(a.templates.dashboardLink)},1e3),$("#completionmodal").modal("show")},scrollTo:function(a,b,c){$("html, body").animate({scrollTop:$("#step"+a).offset().top-b},c)},generateInitCode:function(a){var b="(function(w, d) { var s = d.createElement('script'); s.src = '//cdn.adpushup.com/"+a+"/adpushup.js'; s.type = 'text/javascript'; s.async = true; (d.getElementsByTagName('head')[0] || d.getElementsByTagName('body')[0]).appendChild(s); })(window, document);";$("#header-code").text('<script data-cfasync="false" type="text/javascript">'+b+"</script>")},rTrim:function(a,b){return a?a.replace(new RegExp(b+"*$"),""):""},domanize:function(a){return a?this.rTrim(a.replace("http://","").replace("https://","").replace("www.",""),"/"):""},apVerificationStep:function(){$("#platformVerificationContent").html(this.templates.otherPlatformVerification),this.generateInitCode(d.addedSite.siteId)},showStep:function(a){a=parseInt(a),$("#step"+a).addClass("active-step"),a>=2&&this.apVerificationStep();for(var b=1;b<a;b++)$("#step"+parseInt(b)+"-check").addClass("fa-check-circle zoomIn");switch(d.addedSite&&a>=1&&this.manipulateElem("#addSiteStr",'<h2 class="text-appear"><span>'+this.domanize(d.addedSite.domain)+"</span> has been Added!</h2>","htmlFadeIn",600),a>2&&$("#apCheck").html("Verified "+this.templates.checkIcon),a>=4&&$("#adsenseoauth").html("Google Adsense Connected "+this.templates.checkIcon),a){case 1:$("#platformVerificationContent").html('<p class="text-center mT-10"><img class="platform-graphic" src="/assets/images/platform.png" width="150" height="150"/></p>');break;case 4:this.setupCompleteAlert()}},nextStep:function(a,b,c){var d=this;$("#step"+b+"-check").addClass("fa-check-circle zoomIn"),setTimeout(function(){$("#step"+a).addClass("active-step"),$("#step"+b).removeClass("active-step"),d.scrollTo(a,120,600)},c)},saveSiteModel:function(b,c,e,f){var g=this;$.post("/data/saveSite",{site:c,siteId:e,step:2},function(c){c.success?(d.addedSite={domain:c.url,siteId:c.siteId},$(".add-site-alt-form").hide(),$("#addSiteStr").fadeIn(),g.manipulateElem("#addSiteStr",'<h2 class="text-appear"><span>'+b+"</span> has been Added!</h2>","htmlFadeIn",600),g.nextStep(2,1,1e3),g.apVerificationStep()):(a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown"),$(f).html("Add "+b+" ?").prop("disabled",!1))})},addSite:function(b,c,e){var f=this;if($(e).html("Adding "+b+" ...").prop("disabled",!0),d.addOtherSite){var g=function(){for(var a in currentUser.sites)if(currentUser.sites[a].domain===c+"/")return!0;return!1};g()?(a.apAlert(f.domanize(c)+" has already been added! Please add a different site.","#apdetect","inverted","slideDown"),$(e).html("Add Site").prop("disabled",!1)):$.post("/user/addSite",{site:c},function(d){d.success?f.saveSiteModel(b,c,d.siteId,e):(a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown"),$(e).html("Lets Add "+b+" ?").prop("disabled",!1))})}else this.saveSiteModel(b,c,d.viewObjects.unSavedSiteId,e)},detectApSuccess:function(b,c){a.apAlert("AdPushup has been successfully detected on the website!","#apdetect","success","slideDown"),d.addOtherSite?$(c).html("Setup Complete "+b.templates.checkIcon).after(b.templates.dashboardLink):($(c).html("Verified "+b.templates.checkIcon),b.nextStep(3,2,1e3))},detectAp:function(b,c){var e=this;$.get("/proxy/detectap",{url:b},function(b){b.ap?$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:d.addOtherSite?4:3},function(a){a.success?e.detectApSuccess(e,c):alert("Some error occurred!")}):(a.apAlert("AdPushup was not detected on the website!","#apdetect","inverted","slideDown"),$(".detectap-error").fadeIn(),$(c).html("Verify").prop("disabled",!1))})},openOauthWindow:function(){var a=screen.width/2-350,b=screen.height/2-225;window.open("/user/requestOauth","Oauth Request","height=485,width=700,left="+a+",top="+b)},copyInitCode:function(){$(".clipboard-copy").fadeIn(),setTimeout(function(){$(".clipboard-copy").fadeOut()},1500),$("#header-code").select(),c.execCommand("copy")},sendCodeToDev:function(a){$("#sendCodeSubmit").prop("disabled",!0).html("Sending..."),$.post("/user/sendCode",a,function(a){a.success?($("#sendCodeSubmit").css("opacity",1).html("Code sent successfully!"),setTimeout(function(){$("#sendToDevModal").modal("toggle"),$("#sendCodeSubmit").prop("disabled",!1).html("Send")},2e3)):alert("Some error occurred!")})},nonAdminAccess:function(a){var b=this;a.html("Saving...").prop("disabled",!0),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:5},function(c){c.success?(a.html("Setup Complete "+b.templates.checkIcon),b.setupCompleteAlert()):alert("Some error occurred!")})},showAddOtherSite:function(){d.addOtherSite&&($("#addSiteStr").html(this.templates.addOtherSite),$("#step2").nextAll("div[id^='step']").hide())},oauthHook:function(b){try{JSON.parse(b.data)}catch(c){return!1}var e=JSON.parse(b.data);e.data?($("#adsenseoauth").html("Google Adsense Connected "+a.onboarding.templates.checkIcon).prop("disabled",!0),$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:4},function(b){b.success?a.onboarding.setupCompleteAlert():alert("Some error occurred!")})):a.apAlert("Some error occurred! Please try again later.","#apdetect","error","slideDown")},skipOauth:function(){var a=this;setTimeout(function(){$("#adsenseoauth").prop("disabled",!0)},1e3);var a=this;$.post("/user/setSiteStep",{siteId:d.addedSite.siteId,step:4,completeOnboarding:!0},function(b){b.success?a.setupCompleteAlert():alert("Some error occurred!")})},init:function(){this.showIntro(),this.showStep(d.defaultStep),this.showAddOtherSite()}},a.onboarding.init(),window.addEventListener("message",a.onboarding.oauthHook,!1),$("#addUserSite").click(function(b){var c=d.viewObjects.domanizedUrl,e=(d.viewObjects.unSavedSiteId,d.viewObjects.origUnSavedDomain);a.onboarding.addSite(c,e,$(this))}),$(c).on("click","#apCheck",function(){$(this).html("Verifying...").prop("disabled",!0),a.onboarding.detectAp(d.addedSite.domain,$(this))}),$("#adsenseoauth").click(function(){a.onboarding.openOauthWindow()}),$("#adsensenonadmin").click(function(){a.onboarding.nonAdminAccess($(this))}),$(c).on("click","#clipboardCopy, #header-code",function(){a.onboarding.copyInitCode()}),$("#sendCodeForm").submit(function(b){b.preventDefault(),$("#headerCodeInput").val($("#header-code").val());var c=$(this).serialize();a.onboarding.sendCodeToDev(c)}),$("#skipOauth").on("click",function(){a.onboarding.skipOauth()}),$("#addSiteAltForm").submit(function(b){b.preventDefault();var c=$(this).serializeArray(),d=c[0].value.replace(/\/$/,"");site=d.replace(/.*?:\/\//g,""),btn=$("#addSiteAltForm button"),a.onboarding.addSite(site,d,btn)})}(adpushup,window,document)});