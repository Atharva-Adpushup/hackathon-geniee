include ../mixins/mixins

- isOnboarding = !!(isOnboarding || false)
- billingError = Object.keys(currentUser).length && currentUser.userType !== "partner" && (!currentUser.billingInfoComplete || !currentUser.paymentInfoComplete) && !isOnboarding && currentUser.dateCreated > 1522540800000

doctype html
html(lang="en")
    block getTitle

    block meta

    head
        block head
                meta(charset="UTF-8")
                block headCss
                    link(href='//fonts.googleapis.com/css?family=Karla', rel='stylesheet', type='text/css')
                    if environment == "production"
                        link(href="/assets/css/builds/website.min.css?v=1523632039544", rel="stylesheet", type="text/css")
                    else
                        link(href="/assets/css/libs/website.css", rel="stylesheet", type="text/css")

                    //- if billingError && !isSuperUser
                    //-     style.
                    //-         .sidebar,
                    //-         .headerTopBar {
                    //-             top: 80px;
                    //-         }

                    //-         .pageContainer .pageContentWrapper .pageContentInner {
                    //-             padding-top: 160px;
                            }

                link(id="favicon", rel="shortcut icon", href="/assets/images/favicon.ico", sizes="48x48", type="image/png")
                title #{titleVar + " - AdPushup"}

                block headScripts
                    - excludeJquery = excludeJquery || false;
                    - excludeBaseLibs = excludeBaseLibs || false;
                    - excludeAnalytics = excludeAnalytics || false;

                    if !excludeJquery
                        if environment == "production"
                            script(type='text/javascript', src='//code.jquery.com/jquery-1.11.2.min.js')
                        else
                            script(type='text/javascript', src='/assets/js/libs/third-party/jquery-3.1.0.min.js')

                    script(type='text/javascript').
                        window.apjQuery = window.jQuery;
                        window.currentUser = !{JSON.stringify(currentUser)};
                    
                    if !excludeBaseLibs
                        - var baseLibsStr = "/assets/js/builds/";
                        - var baseLibsFinalStr = (environment == "production") ? (baseLibsStr + "base-libs.min.js") : ("/assets/js/libs/custom/base-libs.js");
                        +loadAsset("js", [baseLibsFinalStr])

                    if environment == "production"
                        script(type='text/javascript').
                            ((window.adpushup = window.adpushup || {}).user = (window.adpushup.user || {}));

                        if !excludeAnalytics
                            script(type='text/javascript').
                                var currentUser = !{JSON.stringify(currentUser)};
                                var sites = (Object.keys(currentUser).length > 0) ? currentUser.sites : [];
                                var siteInfo = "", segmentAppId = !{JSON.stringify(consts.analytics["SEGMENT_APP_ID"])};

                                window.adpushup.user.sites = sites;
                                //Segment Analytics Starts
                                !function () {
                                    var analytics = window.analytics = window.analytics || [];
                                    if (!analytics.initialize)if (analytics.invoked)window.console && console.error && console.error("Segment snippet included twice."); else {
                                        analytics.invoked = !0;
                                        analytics.methods = ["trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "group", "track", "ready", "alias", "page", "once", "off", "on"];
                                        analytics.factory = function (t) {
                                            return function () {
                                                var e = Array.prototype.slice.call(arguments);
                                                e.unshift(t);
                                                analytics.push(e);
                                                return analytics
                                            }
                                        };
                                        for (var t = 0; t < analytics.methods.length; t++) {
                                            var e = analytics.methods[t];
                                            analytics[e] = analytics.factory(e)
                                        }
                                        analytics.load = function (t) {
                                            var e = document.createElement("script");
                                            e.type = "text/javascript";
                                            e.async = false;
                                            e.src = ("https:" === document.location.protocol ? "https://" : "http://") + "cdn.segment.com/analytics.js/v1/" + t + "/analytics.min.js";
                                            e.onload = function () {
                                                window.overrideTrackers();
                                            };
                                            var n = document.getElementsByTagName("script")[0];
                                            n.parentNode.insertBefore(e, n)
                                        };
                                        analytics.SNIPPET_VERSION = "3.0.1";
                                        analytics.load(segmentAppId);
                                    }
                                }();
                                window.overrideTrackers();

    body
        // User specific jade variables defined to prevent the
        // hassle of defining them at 'app locals' level or send them
        // as parameters to jade files
        - currentUser = currentUser || {};
        - currentUserSites = (currentUser && currentUser.sites) ? currentUser.sites : [];
        - primarySiteDetails = (currentUserSites && currentUserSites.length) ? currentUserSites[0] : {};
        - isRequestDemo = (currentUser && currentUser.requestDemo) ? currentUser.requestDemo : null;
        - isUserOnboarded = (primarySiteDetails && primarySiteDetails.domain && primarySiteDetails.siteId && primarySiteDetails.step) ? true : false;

        //- if billingError && !isSuperUser
        //-     .custom-message.error-text.dashboard-text.billing-error
        //-         if !currentUser.billingInfoComplete || !currentUser.paymentInfoComplete
        //-             i(class="fa fa-warning" style="margin-right: 10px;") 
        //-             | To start seeing ads, please complete - 
        //-         if !currentUser.billingInfoComplete
        //-             | Billing profile 
        //-             a(href="/user/billing") here. 
        //-         if !currentUser.paymentInfoComplete
        //-             | Payment details 
        //-             a(href="/user/payment") here. 
        //-             | If you're using ads.txt, kindly paste the ads.txt configuration from the site's tags manager panel to your website.

        if !excludeAnalytics
            if environment == "production"
                block analyticsIdentify
                    script(type="text/javascript").
                        if (Object.keys(window.currentUser).length > 0 && (sites.length > 0)) {
                            sites.map(function (obj, idx) {
                                siteInfo += obj.siteId + " " + obj.domain + " | ";
                            });
                        }
                script(type="text/javascript" src="/assets/js/libs/custom/adpushup-analytics.js")
                script(type="text/javascript").
                    if (window.currentUser.email) {
                        var data = {
                            email: window.currentUser.email,
                            analytics: {
                                name: (window.currentUser.firstName + ((window.currentUser.lastName && window.currentUser.lastName.length > 0) ? ' ' + window.currentUser.lastName : "")),
                                email: window.currentUser.email,
                                sites: siteInfo
                            }
                        }
                        adpushupAnalyticsEvents.emit('analyticsIdentify', data);
                    }
            else
                script(type="text/javascript" src="/assets/js/libs/custom/adpushup-analytics-mockup.js")

        block bodyContent
        div(id="freeow-tr", class="freeow freeow-top-right")
